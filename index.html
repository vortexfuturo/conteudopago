<!doctype html>
<html lang="pt-BR" translate="no">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" content="notranslate" />
    <title>privacylarissa</title>

    <!-- Captura e Persist√™ncia de UTMs -->
    <script>
    (function() {
      const params = new URLSearchParams(window.location.search);
      const utms = ['utm_source','utm_medium','utm_campaign','utm_content','utm_term'];
      utms.forEach(key => {
        const value = params.get(key);
        if (value) {
          localStorage.setItem(key, value);
        }
      });

      window.keepUTM = function(url) {
        const stored = {};
        utms.forEach(key => {
          const value = localStorage.getItem(key);
          if (value) stored[key] = value;
        });
        const query = new URLSearchParams(stored).toString();
        if (query) {
          const separator = url.includes('?') ? '&' : '?';
          return url + separator + query;
        }
        return url;
      };
    })();
    </script>

    <!-- Pixel Meta Ads - Inicializa√ß√£o e disparo SOMENTE no clique -->
    <script>
      // Carrega o script do Facebook Pixel
      !function(f,b,e,v,n,t,s) {
        if(f.fbq)return;n=f.fbq=function() {
          n.callMethod ? n.callMethod.apply(n,arguments) : n.queue.push(arguments)
        };
        if(!f._fbq)f._fbq=n;
        n.push=n;
        n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)
      }(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');

      // IDs dos 5 pixels
      const PIXELS = ['1421303535603181', '636629812664247', '825290560048721', '804023795319915', '1153949476657735'];

      // Inicializa TODOS os 5 pixels no carregamento (sem disparar eventos)
      console.log('üîÑ Inicializando 5 pixels Meta Ads...');
      PIXELS.forEach((pixelId, index) => {
        fbq('init', pixelId, {}, {
          autoConfig: false,
          debug: false
        });
        console.log(`  ‚úì Pixel ${index + 1}/5 inicializado: ${pixelId}`);
      });
      console.log('‚úÖ TODOS os 5 pixels prontos! Aguardando login para disparar Purchase...');

      // Captura utm_source da URL e armazena
      function getUTMSource() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('utm_source') || 'conta1';
      }

      const trafficSource = getUTMSource();
      localStorage.setItem('traffic_source', trafficSource);

      // Fun√ß√£o para disparar Purchase MANUALMENTE (chamada no login)
      window.firePurchaseEvent = async function(email) {
        const source = localStorage.getItem('traffic_source') || 'conta1';

        // Verifica no Supabase se j√° disparou Purchase para este IP
        let shouldFire = true;
        if (window.logPurchaseToSupabase) {
          shouldFire = await window.logPurchaseToSupabase(email, source);
        }

        // Dispara somente se for primeira vez deste IP
        if (shouldFire) {
          console.log('');
          console.log('üéØ DISPARANDO PURCHASE NOS 5 PIXELS META ADS');
          console.log('üìä Valor: R$ 10,00 | Moeda: BRL');
          console.log('üìç Fonte:', source);
          console.log('');

          // Dispara Purchase em cada um dos 5 pixels
          PIXELS.forEach((pixelId, index) => {
            fbq('trackSingle', pixelId, 'Purchase', {
              value: 10.00,
              currency: 'BRL'
            });
            console.log(`‚úÖ [${index + 1}/5] Purchase enviado para pixel: ${pixelId}`);
          });

          console.log('');
          console.log('üéâ CONCLU√çDO! Purchase disparado nos 5 pixels com sucesso!');
          console.log('');
        } else {
          console.log('‚ö†Ô∏è Purchase N√ÉO foi disparado - Este IP j√° realizou Purchase anteriormente');
        }
      };
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
